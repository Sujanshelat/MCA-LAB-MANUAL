.INCLUDE "M32DEF.INC"
.EQU DPRT=PORTA
.EQU DDDA=DDRA
.EQU DPIN=PINA
.EQU CPORT=PORTC
.EQU CDDR=DDRC
.EQU RW=1
.EQU RS=0
.EQU EN=2

LDI R16,HIGH(RAMEND)
OUT SPH,R16
LDI R16,LOW(RAMEND)
OUT SPL,R16

LDI R17,$FF
OUT DDDR,R17
OUT CDDR R17
CBI CPORT,EN
CALL DELAY_20MS

LDI R21,0X38
CALL CMD
LDI R21,0X0E
CALL CMD
LDI R21,0X01
CALL CMD
CALL DELAY_2MS
LDI R21,'D'
CALL DATA
LDI R21,'D'
CALL DATA
LDI R21,'U'
CALL DATA
HERE: RJMP HERE

CMD:
		CBI CPORT,RS
		CALL GEN
		RET
DATA:
		SBI CPORT,RS
		CALL GEN
		LDI R21,0X06
		CALL CMD
		RET
GEN:

		CBI CPORT,RW
		OUT DPORT,R21
		SBI CPORT,EN
		NOP
		CBI CPORT,EN
		CALL DLAY_100US
		RET

DELAY_100US:
		PUSH R17
		LDI R17,60
		CALL SDELAY
		DEC R17
		BBRNE LDRO
		POP R17
		RET
DELAY_20MS:
		PUSH R17
		LDIR17,20
LDRO:
		CALL DELAY_100US
		DEC R17